{% extends 'books/admin/admin_base_list.html' %}
{% load permissions %}


{% block list_title %}Genre List{% endblock %}

{% block list_heading %}Genre{% endblock %}

{% block list_description %}
    This section provides a detailed overview of all available Genres of
    Book.
{% endblock %}


{% block search_placeholder %}Search Genre {% endblock %}

{% block add_perm %}genres.add_genre{% endblock %}
{% block sort_title_asc %}Name{% endblock %}
{% block sort_title_desc %}Name{% endblock %}
{% block add_url %}{% url 'genre_view' %}{% endblock %}
{% block entity_name %}Genre{% endblock %}

{% block table_headers %}
    {#    <th class="min-w-48 p-3 text-sm font-semibold tracking-wide text-left">Cover Image</th>#}
    <th class="min-w-48 p-3 text-sm font-semibold tracking-wide text-left">Name</th>
    <th class="min-w-48 p-3 text-sm font-semibold tracking-wide text-left">description</th>
    <th class="min-w-48 p-3 text-sm font-semibold tracking-wide text-left">parent_genre</th>
{% endblock %}
{% block columns_count %}6{% endblock %}

{% block table_body %}
    {% for genre in paginated_genre %}
        <tr class="{% if forloop.counter|divisibleby:2 %}bg-gray-300{% else %}bg-gray-50{% endif %}">
            {#            <td class="p-3 text-sm text-gray-700"> {% if publisher.profile_image %}#}
            {#                <img src="{{ publisher.profile_image.url }}"#}
            {#                     alt="{{ publisher.name }}"#}
            {#                     class="h-10 w-8 object-cover"/>#}
            {#            {% else %}#}
            {#                <span class="italic text-gray-400">No cover available</span>#}
            {#            {% endif %}</td>#}
            <td class="p-3 text-sm text-gray-700">{{ genre.name }}</td>
            <td class="p-3 text-sm text-gray-700">{{ genre.description|default:"-" }}</td>
            <td class="p-3 text-sm text-gray-700">{{ genre.parent_genre|default:"-" }}</td>

            <td class="p-3 text-sm text-gray-700">
                <div class="flex  space-x-2 gap-1">

                    <button class="bg-indigo-600 hover:bg-indigo-800 text-white font-bold py-2 px-4 rounded">
                        <a href="{% url 'genre_detail_view' genre.uuid %}">View</a>
                    </button>

                    {% if request.user|has_perm:"genres.change_genre" %}
                        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">

                            <a href="{% url 'genre_view' genre.uuid %}">Edit</a>
                        </button>
                        <button
                                type="button"
                                class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
                                onclick="openModal('{{ genre.uuid }}', 'delete')"
                        >
                            Delete
                        </button>
                    {% endif %}
                </div>

            </td>
        </tr>
    {% empty %}
        <tr>
            <td colspan="9" class="text-center p-4 text-gray-500">
                No Rows Found
            </td>
        </tr>
    {% endfor %}
{% endblock %}

{% block pagination %}
    {% with paginated_genre as paginated_items %}
        {{ block.super }}
    {% endwith %}
{% endblock %}




{% block modals %}
    <div id="deleteModal" class="fixed inset-0 hidden justify-center items-center z-60 backdrop-blur-sm bg-white/10">
        <div class="bg-white rounded-lg p-6 w-[90%] max-w-md">
            <p class="text-lg text-gray-800">Are you sure you want to delete this Genre?</p>
            <div class="flex justify-end gap-3">
                <button onclick="closeModal('delete')" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Cancel
                </button>
                <form id="deleteForm" method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="delete" value="1">
                    <button type="submit" name="delete"
                            class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                        Yes, Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}



{% block search_url %}/admin-panel/search/genres{% endblock %}
{% block response_data_key %}genres{% endblock %}
{% block modal_form_action %}/admin-panel/genre/delete/{% endblock %}


{% block base_script %}
    {{ block.super }}

    <script>
        {#console.log("Hello child");#}

        function formatDate(dateStr) {
            if (!dateStr) return "-";
            const options = {year: "numeric", month: "short", day: "numeric"};
            const date = new Date(dateStr);
            return date.toLocaleDateString(undefined, options); // e.g., "May 15, 2023"
        }

        // Override the renderItems function for books
        function renderItems(genres) {
            console.log('genres: ', genres);
            if (genres.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center p-4 text-gray-500">No Rows Found</td></tr>`;
                return;
            }

            tableBody.innerHTML = genres.map((genre, index) => {
                {#const coverImage = publisher.cover_image#}
                {#    ? `<img src="${publisher.cover_image}" alt="${publisher.title}" class="h-10 w-8 object-cover"/>`#}
                {#    : `<span class="italic text-gray-400">No cover available</span>`;#}

                const name = genre.name || "-";

// contact email
                const description = genre?.description != null
                    ? genre.description
                    : "-";
// website email
                const parent_genre = genre?.parent_genre != null
                    ? genre.parent_genre
                    : "-";


                return `
                <tr class="${index % 2 === 0 ? 'bg-gray-50' : 'bg-gray-300'}">
                    <td class="p-3 text-sm text-gray-700">${name}</td>
                    <td class="p-3 text-sm text-gray-700">${description}</td>
                    <td class="p-3 text-sm text-gray-700">${parent_genre}</td>

                    <td class="p-3 text-sm text-gray-700">
                        <div class="flex space-x-2 gap-1">
                            <a href="/admin-panel/genre/detail/${genre.uuid}" class="bg-indigo-600 hover:bg-indigo-800 text-white font-bold py-2 px-4 rounded">View</a>
                            <a href="/admin-panel/genre/edit/${genre.uuid}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Edit</a>
                            <button onclick="openModal('${genre.uuid}', 'delete')" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Delete</button>
                        </div>
                    </td>
                </tr>`;
            }).join('');
        }
    </script>
{% endblock %}


