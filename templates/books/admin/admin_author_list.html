{% extends 'books/admin/admin_base_list.html' %}
{% load permissions %}


{% block list_title %}Stock List{% endblock %}

{% block list_heading %}Authors{% endblock %}

{% block list_description %}
    This section provides a detailed overview of all available Authors of
    Book.
{% endblock %}

{% block search_placeholder %}Search Titles, Authors{% endblock %}

{% block add_perm %}authors.add_author{% endblock %}
{% block sort_title_asc %}Name{% endblock %}
{% block sort_title_desc %}Name{% endblock %}
{% block add_url %}{% url 'author_view' %}{% endblock %}
{% block entity_name %}Author{% endblock %}

{% block table_headers %}
    <th class="min-w-48 p-3 text-sm font-semibold tracking-wide text-left">Profile Image</th>
    <th class="min-w-48 p-3 text-sm font-semibold tracking-wide text-left">Author Name</th>
    <th class="min-w-48 p-3 text-sm font-semibold tracking-wide text-left">Bio</th>
    <th class="min-w-48 p-3 text-sm font-semibold tracking-wide text-left">Nationality</th>
{% endblock %}
{% block columns_count %}5{% endblock %}
{% block table_body %}
    {% for author in paginated_authors %}

        <tr class="{% if forloop.counter|divisibleby:2 %}bg-gray-300{% else %}bg-gray-50{% endif %}">
            <td class="p-3 text-sm text-gray-700"> {% if author.profile_image %}
                <img src="{{ author.profile_image.url }}"
                     alt="{{ author.name }}"
                     class="h-10 w-8 object-cover"/>
            {% else %}
                <span class="italic text-gray-400">No image available</span>
            {% endif %}</td>
            <td class="p-3 text-sm text-gray-700">{{ author.name }}</td>

            <td class="p-3 text-sm text-gray-700">{% if stock.discount_percentage %}
                {{ stock.discount_percentage|floatformat:-2 }}% â†’ Rs
                {{ stock.discount_amount|floatformat:"2"|floatformat:"g" }}
            {% else %}
                -
            {% endif %}</td>
            <td class="p-3 text-sm text-gray-700">{{ stock.stock_quantity|default:'-' }}</td>

            <td class="p-3 text-sm text-gray-700">
                <div class="flex  space-x-2 gap-1">

                    <button class="bg-indigo-600 hover:bg-indigo-800 text-white font-bold py-2 px-4 rounded">
                        <a href="{% url 'author_detail_view' author.uuid %}">View</a>
                    </button>

                    {% if request.user|has_perm:"stock.change_stock" %}
                        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">

                            <a href="{% url 'author_view' author.uuid %}">Edit</a>
                        </button>
                        <button
                                type="button"
                                class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
                                onclick="openModal('{{ book.uuid }}', 'delete')"
                        >
                            Delete
                        </button>
                    {% endif %}
                </div>

            </td>
        </tr>
    {% empty %}
        <tr>
            <td colspan="9" class="text-center p-4 text-gray-500">
                No Rows Found
            </td>
        </tr>
    {% endfor %}
{% endblock %}

{% block pagination %}
    {% with paginated_authors as paginated_items %}
        {{ block.super }}
    {% endwith %}
{% endblock %}


{% block modals %}
    <div id="deleteModal" class="fixed inset-0 hidden justify-center items-center z-60 backdrop-blur-sm bg-white/10">
        <div class="bg-white rounded-lg p-6 w-[90%] max-w-md">
            <p class="text-lg text-gray-800">Are you sure you want to delete this author?</p>
            <div class="flex justify-end gap-3">
                <button onclick="closeModal('delete')" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Cancel
                </button>
                <form id="deleteForm" method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="delete" value="1">
                    <button type="submit" name="delete"
                            class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                        Yes, Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}


{% block search_url %}/admin-panel/search/authors{% endblock %}
{% block response_data_key %}authors{% endblock %}
{% block modal_form_action %}/admin-panel/author/{% endblock %}


{% block base_script %}
    {{ block.super }}
    <script>


        function renderItems(authors) {
            console.log(authors);
            if (authors.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="9" class="text-center p-4 text-gray-500">No Rows Found</td></tr>`
                return;
            }

            tableBody.innerHTML = authors.map((author, index) => {

                // cover image or fallback
                const profileImage = author.profile_image
                    ? `<img src="${author.profile_image}" alt="${author.name}" class="h-10 w-8 object-cover"/>`
                    : `<span class="italic text-gray-400">No image available</span>`;

                // publisher
                const name = author.name || "-";

                // stock price
                const bio = author?.bio != null
                    ? author.bio
                    : "-";

                // discount
                const nationality = (author?.nationality != null)
                    ? author.nationality
                    : "-";


                return `
        <tr class="${index % 2 === 0 ? 'bg-gray-50' : 'bg-gray-300'}">
            <td class="p-3 text-sm text-gray-700">${profileImage}</td>
            <td class="p-3 text-sm text-gray-700">${name}</td>
            <td class="p-3 text-sm text-gray-700">${bio}</td>
            <td class="p-3 text-sm text-gray-700">${nationality}</td>
            <td class="p-3 text-sm text-gray-700">
                <div class="flex space-x-2 gap-1">

                    <a href="/admin-panel/author/detail/${author?.uuid}" class="bg-indigo-600 hover:bg-indigo-800 text-white font-bold py-2 px-4 rounded">View</a>

                    <a href="/admin-panel/author/edit/${author?.uuid}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Edit</a>
                    <button onclick="openModal('${author?.uuid}', 'delete')" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Delete</button>

                </div>
            </td>
        </tr>
    `;
            }).join('');
        }
    </script>
{% endblock %}


