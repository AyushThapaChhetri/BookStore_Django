{% load form_tags %}
<form method="post" class="w-full " id="{{ title }}Form" enctype="multipart/form-data">
    <h2 class="mb-5 text-2xl font-extrabold leading-none tracking-tight text-gray-500 md:text-4xl ">
        {% if form.instance.pk %}Edit {{ title }}{% else %}Add New {{ title }} {% endif %}</h2>
    {% csrf_token %}
    {% for field in form %}
        <div class="relative z-0 w-full mb-5 group">
            {% if field|widget_type == "file" %}
                <!-- File Input -->
                <input
                        type="file"
                        name="{{ field.html_name }}"
                        id="{{ field.id_for_label }}"
                        class="block py-2.5 px-0 w-full text-[16px] text-gray-900 bg-transparent border-0 border-b-2 {% if field.errors %}border-red-500{% else %}border-gray-300{% endif %} appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                />
                <label
                        for="{{ field.id_for_label }}"
                        class="peer-focus:font-medium absolute text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                >
                    {{ field.label }}
                </label>
                {% if field.value %}
                    <p class="mt-2 text-sm text-gray-600">
                        Currently:
                        <a href="{{ field.value.url }}" target="_blank" class="text-blue-600 underline">
                            {{ field.value.name }}
                        </a>
                    </p>
                {% endif %}

            {% elif field|widget_type == "textarea" %}
                <!-- Textarea -->
                <textarea
                        name="{{ field.html_name }}"
                        id="{{ field.id_for_label }}"
                        rows="5"
                        class="block py-2.5 px-0 w-full text-[16px] text-gray-900 bg-transparent border-0 border-b-2 {% if field.errors %}border-red-500{% else %}border-gray-300{% endif %} appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer resize-vertical"
                        placeholder=" "
                >{{ field.value|default_if_none:'' }}</textarea>
                <label
                        for="{{ field.id_for_label }}"
                        class="peer-focus:font-medium absolute text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                >
                    {{ field.label }}
                </label>

            {% elif field|widget_type == "select" %}
                <!-- Single Select -->
                <select
                        name="{{ field.html_name }}"
                        id="{{ field.id_for_label }}"
                        class="block py-2.5 px-0 w-full text-[16px] text-gray-900 bg-transparent border-0 border-b-2 {% if field.errors %}border-red-500{% else %}border-gray-300{% endif %} appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                >
                    <option value="">---------</option>
                    {% for choice_value, choice_label in field.field.choices %}
                        <option value="{{ choice_value }}"
                                {% if choice_value == field.value %}selected{% endif %}>
                            {{ choice_label }}
                        </option>
                    {% endfor %}
                </select>
                <label
                        for="{{ field.id_for_label }}"
                        class="peer-focus:font-medium absolute text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                >
                    {{ field.label }}
                </label>

            {% elif field|widget_type == "select_multiple" %}
                <div class="flex flex-row gap-2">
                    <div class="flex flex-col grow ">


                        <!-- Multiple Select -->
                        <select
                                name="{{ field.html_name }}"
                                id="{{ field.id_for_label }}"
                                multiple
                                class="block py-2.5 px-2 w-full text-[16px] text-gray-900 bg-white border-2 {% if field.errors %}border-red-500{% else %}border-gray-300{% endif %} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent min-h-[100px]"
                        >
                            {% for choice_value, choice_label in field.field.choices %}
                                <option value="{{ choice_value }}"
                                        {% if choice_value in field.value %}selected{% endif %}>
                                    {{ choice_label }}
                                </option>
                            {% endfor %}
                        </select>
                        <label
                                for="{{ field.id_for_label }}"
                                class="block text-sm font-medium text-gray-500 mb-1"
                        >
                            {{ field.label }} (Hold Ctrl/Cmd to select multiple)
                        </label>

                    </div>
                    <button class="h-fit border-1 border-gray-400 shadow-lg rounded-md active:bg-blue-200 active:border-white active:text-white"
                            type="button" onclick="openModal('{{ field.name }}')">

                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                             stroke-width="1.5"
                             stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
                        </svg>
                    </button>

                </div>



            {% else %}
                <!-- Regular Input Fields -->
                <input
                        type="{{ field|input_type }}"
                        name="{{ field.html_name }}"
                        id="{{ field.id_for_label }}"
                        value="{{ field.value|default_if_none:'' }}"
                        class="block py-2.5 px-0 w-full text-[16px] text-gray-900 bg-transparent border-0 border-b-2 {% if field.errors %}border-red-500{% else %}border-gray-300{% endif %} appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                        placeholder=" "
                />
                <label
                        for="{{ field.id_for_label }}"
                        class="peer-focus:font-medium absolute text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                >
                    {{ field.label }}
                </label>
            {% endif %}

            {% if field.errors %}
                {% for error in field.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ error }}</p>
                {% endfor %}
            {% endif %}
        </div>

    {% endfor %}

    <div class="flex flex-row m-0 p-0 gap-3">
        <button type="button" onclick="closeLogoutModal()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">
            Cancel
        </button>
        <button type="button" onclick="submitPopupForm('{{ form_type }}')"
                class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
            Submit
        </button>
    </div>
</form>